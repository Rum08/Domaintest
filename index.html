<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sun</title>
  <link rel="stylesheet" href="css/style-domain.css">
</head>
<body>
  <!-- gọi chạy pháo hoa -->
  <canvas id="canvas"></canvas>

  <!-- Hai dòng domain, sẽ được gán text bằng JS -->
  <h1 class="moving-domain" id="domain1">
  <span class="icon">✅</span>
  <span class="domain-text"></span>
</h1>

<h1 class="moving-domain" id="domain2">
  <span class="icon">✅</span>
  <span class="domain-text"></span>
</h1>


  <!-- Script đọc config.json và set domain + firework -->
      <!-- Script đọc config + moving text -->
  <script>
  const CONFIG_URL = "config.json";

  let domain1 = null;
  let domain2 = null;

  // ====== Đọc config.json và gán title / domain / firework ======
  async function applyConfig() {
  try {
    const res = await fetch(CONFIG_URL + "?t=" + Date.now(), { cache: "no-cache" });
    if (!res.ok) throw new Error("Không load được config.json");
    const cfg = await res.json();

    if (cfg.title) {
      document.title = cfg.title;
    }

    const domains = cfg.domains || [];

    // Lấy span domain-text bên trong mỗi h1
    const d1Text = domain1.querySelector(".domain-text");
    const d2Text = domain2.querySelector(".domain-text");

    if (d1Text) d1Text.textContent = domains[0] || "";
    if (d2Text) d2Text.textContent = domains[1] || "";

    window.ENABLE_FIREWORK = cfg.enableFirework === true;

  } catch (e) {
    console.error(e);

    const d1Text = domain1?.querySelector(".domain-text");
    const d2Text = domain2?.querySelector(".domain-text");

    if (d1Text) d1Text.textContent = "SUN.WIN";
    if (d2Text) d2Text.textContent = "GEM.WIN";

    window.ENABLE_FIREWORK = false;
  }
}

  // ====== Moving / Bouncing 2 dòng domain ======
  let x1, y1, dx1, dy1;
  let x2, y2, dx2, dy2;

  function random(min, max) {
    return Math.random() * (max - min) + min;
  }

  function initPositions() {
    // Nếu vì lý do gì đó domain1/domain2 chưa sẵn sàng thì bỏ qua lần này
    if (!domain1 || !domain2) {
      console.warn("initPositions() gọi khi domain1/domain2 chưa sẵn sàng");
      return;
    }

    const W = window.innerWidth;
    const H = window.innerHeight;

    const w1 = domain1.offsetWidth;
    const h1 = domain1.offsetHeight;
    const w2 = domain2.offsetWidth;
    const h2 = domain2.offsetHeight;

    x1 = random(0, Math.max(1, W - w1));
    y1 = random(0, Math.max(1, H - h1));
    x2 = random(0, Math.max(1, W - w2));
    y2 = random(0, Math.max(1, H - h2));

    // dx1 = 1 * (Math.random() < 0.5 ? 1 : -1);
    dx1 = 1.3 * (Math.random() < 0.5 ? 1 : -1);   
    dy1 = 1.6 * (Math.random() < 0.5 ? 1 : -1);

    dx2 = 1.3 * (Math.random() < 0.5 ? 1 : -1);
    dy2 = 1.6 * (Math.random() < 0.5 ? 1 : -1);
  }

  function animate1() {
    if (!domain1) return; // phòng hờ
    const W = window.innerWidth;
    const H = window.innerHeight;
    const w = domain1.offsetWidth;
    const h = domain1.offsetHeight;

    x1 += dx1;
    y1 += dy1;

    if (x1 <= 0 || x1 + w >= W) dx1 = -dx1;
    if (y1 <= 0 || y1 + h >= H) dy1 = -dy1;

    domain1.style.left = x1 + "px";
    domain1.style.top  = y1 + "px";

    requestAnimationFrame(animate1);
  }

  function animate2() {
    if (!domain2) return; // phòng hờ
    const W = window.innerWidth;
    const H = window.innerHeight;
    const w = domain2.offsetWidth;
    const h = domain2.offsetHeight;

    x2 += dx2;
    y2 += dy2;

    if (x2 <= 0 || x2 + w >= W) dx2 = -dx2;
    if (y2 <= 0 || y2 + h >= H) dy2 = -dy2;

    domain2.style.left = x2 + "px";
    domain2.style.top  = y2 + "px";

    requestAnimationFrame(animate2);
  }

  // ====== Khởi động tất cả ======
  async function startAll() {
    // DOM đã có 2 thẻ h1 (vì script nằm cuối body)
    domain1 = document.getElementById("domain1");
    domain2 = document.getElementById("domain2");

    if (!domain1 || !domain2) {
      console.error("Không tìm thấy #domain1 hoặc #domain2 trong DOM");
      return;
    }

    // Lần đầu: đọc config để có text + enableFirework
    await applyConfig();

    // Đợi 1 frame để browser layout xong (và autofit.js có thể chạy),
    // rồi mới đo offsetWidth cho chính xác:
    requestAnimationFrame(() => {
      initPositions();
      animate1();
      animate2();
    });

    // Tự động đọc lại config sau mỗi 10s → đổi domain không cần reload
    setInterval(applyConfig, 10000);

    // Gắn resize listener SAU khi domain1/domain2 đã có
    window.addEventListener("resize", initPositions);
  }

  window.addEventListener("load", startAll);
</script>


</body>
</html>